{
  "extends": ["config:recommended"],
  "prConcurrentLimit": 5,

  "enabledManagers": [
    "gomod",
    "dockerfile",
    "helm-values",
    "regex"
  ],

  /* Renovate will scan only "charts/testmachinery/values.yaml" */
  "helm-values": {
    "fileMatch": [
      "charts/testmachinery/values.yaml"
    ]
  },

  /* Regex manager config for ".ocm/resources.yaml" */
  "regexManagers": [
    {
      "fileMatch": ["^\\.ocm/resources\\.yaml$"],
      "matchStrings": [
        "imageReference:\\s*(?<depName>[^:]+):(?<currentValue>[^\\s#]+)\\s*\\n\\s*version:\\s*(?<currentValue2>[^\\s#]+)"
      ],
      "datasourceTemplate": "docker",
      "versioningTemplate": "docker"
    }
  ],

  "packageRules": [
    /* Go modules at root of repository */
    {
      "matchManagers": ["gomod"],
      "matchPaths": ["/"]
    },

    /* Ignore minor & major updates for Argo Workflows */
    {
      "matchManagers": ["gomod"],
      "matchPackageNames": ["github.com/argoproj/argo-workflows"],
      "allowedVersions": "/^0\\./"
    },

    /* Group all version updates except Gardener, Argo, OCM, controller-runtime */
    {
      "matchPackagePatterns": [
        "^github\\.com/gardener/gardener.*",
        "^github\\.com/argoproj/argo-workflows.*",
        "^ocm\\.software/ocm.*",
        "^sigs\\.k8s\\.io/controller-runtime.*"
      ],
      "enabled": false
    },
    {
      "matchManagers": ["gomod"],
      "matchUpdateTypes": ["minor", "patch", "major"],
      "groupName": "all-other-go-dependencies",
      "matchPackagePatterns": [".*"],
    },

    /* ONLY update Alpine + the OCMCLI image in Dockerfile at root of repository */
    {
      "matchManagers": ["dockerfile"],
      "matchPaths": ["/"],
      "matchPackageNames": [
        "^alpine$",
        "^ghcr\\.io/open-component-model/ocm/ocm\\.software/ocmcli/ocmcli-image$"
      ]
    },

    /* ONLY update these Helm chart image references */
    {
      "matchManagers": ["helm-values"],
      "matchPackageNames": [
        /* Argo */
        "quay.io/argoproj/workflow-controller",
        "quay.io/argoproj/argoexec",
        "quay.io/argoproj/argocli",

        /* Valitail & Vali */
        "europe-docker.pkg.dev/gardener-project/releases/3rd/credativ/valitail",
        "europe-docker.pkg.dev/gardener-project/releases/3rd/credativ/vali"
      ]
    },

    /* OCM regex image rules */
    {
      "matchManagers": ["regex"],
      "matchPackagePatterns": [
        "^quay\\.io/argoproj/.*$",
        "^europe-docker\\.pkg\\.dev/gardener-project/releases/3rd/credativ/.*$"
      ]
    }
  ]
}
